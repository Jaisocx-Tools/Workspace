<!DOCTYPE html>
<html lang="en" class="jsx">
<head>

  <title>Tree</title>

  <base href="./" />

  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />



  <script>

    let statLinkTagsPreloading = {
      "icon_brightday": 1,
      "font_LibreFranklin_Medium": 1,
      "font_LibreFranklin_Regular": 1,
      "font_LibreFranklin_SemiBold": 1,
      "stylesheet_cdn_fonts": 1
    };



    let statLinksLoadingStopOnTimeout = ( idsObject ) => {

      console.log( "Started script, cleaning up hanging hard preloads links, if cdn doesn't respond, in order to prevent blocked render in the browser." );

      let ids = Object.keys( idsObject );
      let idsNumber = ids.length;
      let id = "";
      let i = 0;
      let tag = new Object();

      let secureCounter = 1;
      let secureMaxCounter = 10;

      marker1: while ( i < idsNumber ) {
        secureCounter++;
        if ( secureCounter >= secureMaxCounter ) {
          break marker1;
        }

        id = ids[i];
        i++;

        if ( idsObject[id] === 3 ) {
          continue marker1;
        }


        let url = "";
        try {
          tag = document.getElementById( id );
          url = tag.getAttribute( "href" );
        } catch (e) {}
        try {
          tag.onerror = null;
        } catch (e) {}
        try {
          tag.setAttribute( "fetchpriority", "low" );
        } catch (e) {}
        try {
          tag.setAttribute( "rel", "stylesheet" );
        } catch (e) {}
        try {
          tag.removeAttribute( "href" );
        } catch (e) {}
        try {
          tag.remove();
          console.log( "Cleaned up, after timeout, the hanging hard preload url:", url );
        } catch (e) {}


        i++;
      }
    }



    setTimeout (
      () => {
        statLinksLoadingStopOnTimeout( statLinkTagsPreloading );
      },
      800
    );

  </script>



  <!--# FAVICON -->
  <!-- <link
    rel="icon"
    type="image/x-icon"
    href="https://sandbox.brightday.email/cdn/www/media/images/favicon/Icon_Jaisocx.ico"
    href-fallback="favicon/Icon_Jaisocx.ico"
    onload="javascript: ( () => { this.onerror = null; const id = this.id; statLinkTagsPreloading[id] = 3; } )();"
    onerror="javascript: ( () => { this.href = this.getAttribute( 'href-fallback' ); } )();"
  /> -->

  <link
    id="icon_brightday"
    rel="icon"
    type="image/x-icon"
    href="https://sandbox.brightday.email/cdn/www/media/images/favicon/Icon_Sandbox_Brightday.ico"
    href-fallback="favicon/Icon_Sandbox_Brightday.ico"
    onload="javascript: ( () => { this.onerror = null; const id = this.id; statLinkTagsPreloading[id] = 3; } )();"
    onerror="javascript: ( () => { this.href = this.getAttribute( 'href-fallback' ); } )();"
  />



  <!--# FONTS PRELOAD WITHOUT JAVASCRIPT CALL -->
  <!-- the crossorigin attribute prevents loading fonts twice.
          The fonts are loaded twice, even if the urls matches exactly in the @font-face src url and tag <link href="" />
  -->
  <link
    id="font_LibreFranklin_Medium"
    fetchpriority="high"
    rel="preload"
    as="font"
    type="font/ttf"
    crossorigin
    href="https://sandbox.brightday.email/cdn/www/fonts/LibreFranklin/static/LibreFranklin-Medium.ttf"
    onload="javascript: ( () => { const id = this.id; statLinkTagsPreloading[id] = 3; } )();"
  />

  <link
    id="font_LibreFranklin_Regular"
    fetchpriority="high"
    rel="preload"
    as="font"
    type="font/ttf"
    crossorigin
    href="https://sandbox.brightday.email/cdn/www/fonts/LibreFranklin/static/LibreFranklin-Regular.ttf"
    onload="javascript: ( () => { const id = this.id; statLinkTagsPreloading[id] = 3; } )();"
  />

  <link
    id="font_LibreFranklin_SemiBold"
    fetchpriority="high"
    rel="preload"
    as="font"
    type="font/ttf"
    crossorigin
    href="https://sandbox.brightday.email/cdn/www/fonts/LibreFranklin/static/LibreFranklin-SemiBold.ttf"
    onload="javascript: ( () => { const id = this.id; statLinkTagsPreloading[id] = 3; } )();"
  />

  <!--# CSS FOR FONTS -->
  <!-- when opened .html file locally, the requested by this .css file fonts are blocked by browsers' CORS. The response headers of a cdn server needed. -->
  <link
    id="stylesheet_cdn_fonts"
    rel="stylesheet"
    type="text/css"
    href="https://sandbox.brightday.email/cdn/www/fonts_css/font_LibreFranklin_cdn.css"
    onload="javascript: ( () => { const id = this.id; statLinkTagsPreloading[id] = 3; } )();"
  />



  <!--# CSS CLEAN START 2: html & css WHEN STARTING A SITE FROM SCRATCH -->

  <!--# importing @jaisocx/css-clean-start-2 IN DEV MODE, TO RESEARCH THE .css STYLES IN BROWSER'S DEV TOOLS IN NETWORKS TAB  -->
  <!-- <link
    rel="stylesheet"
    type="text/css"
    charset="utf-8"
    href="node_modules/@jaisocx/css-clean-start-2/MediaAndStyles/CssCleanStart_2_main_relative.css"
    href-fallback="../css-clean-start-2/MediaAndStyles/CssCleanStart_2_main_relative.css"
    onerror="javascript: ( () => { this.onerror = null; this.href = this.getAttribute( 'href-fallback' ); } )();"
  /> -->

  <!--# THE SAME importing @jaisocx/css-clean-start-2 IN PROD MODE, PACKED BY @jaisocx/css-importer TOOL  -->
  <link
    rel="stylesheet"
    type="text/css"
    charset="utf-8"
    href="node_modules/@jaisocx/css-clean-start-2/MediaAndStyles/CssCleanStart_2_main_resolved_minimal.css"
    href-fallback="../css-clean-start-2/MediaAndStyles/CssCleanStart_2_main_resolved_minimal.css"
    onerror="javascript: ( () => { this.href = this.getAttribute( 'href-fallback' ); this.onerror = null; } )();"
  />





  <!--# STYLES Tree and theme_base -->
  <link
    rel="stylesheet"
    type="text/css"
    charset="utf-8"
    href="MediaAndStyles/Tree_main_resolved_minimal.css"
  />



  <!--# Theme funny -->
  <!--# importing theme  in this @jaisocx/tree npm package -->
  <link
    rel="stylesheet"
    type="text/css"
    charset="utf-8"
    href="MediaAndStyles/themes/theme-funny/tree_theme-funny_fonts.css"
  />

  <link
    rel="stylesheet"
    type="text/css"
    charset="utf-8"
    href="MediaAndStyles/themes/theme-funny/tree_theme-funny.css"
  />



  <style>

    .jsx {
      --jsx--css-clean-start-2--site--padding: 2rem 1rem 3rem 1rem;

      --jsx--css-clean-start-2--h1--font-size: 1.05rem;
      --jsx--css-clean-start-2--h2--font-size: 0.9rem;
      --jsx--css-clean-start-2--h3--font-size: 0.83rem;

      --jsx--css-clean-start-2--h2--font-weight: 500;

      --jsx--css-clean-start-2--all-tags--font-family: LibreFranklin;

      --theme-button-width: fit-content;
    }

    @media screen and (orientation: portrait) {
      .jsx description {
        display: none;
      }
    }

    .jsx themebuttons {
      width: fit-content;
      display: grid;
      grid-auto-flow: column;
      column-gap: 3rem;
      margin: 0.9rem 0px 1.6rem 0px;
    }

    .jsx themebuttons button {
      width: var(--theme-button-width);
    }

    .current::after {
      content: "";
      position: absolute;
      bottom: -0.3rem;
      left: 0;
      width: 100%;
      height: 0;
      max-height: 0;
      overflow-y: hidden;
      border-bottom-width: 0.14rem;
      border-bottom-style: solid;
      border-bottom-color: var(--clean-start__text-color);
    }

    .jsx button {
      background-color: transparent;
      text-align: left;
    }

    #tooltip-button {
      font-family: fantasy;
    }

  </style>
</head>
<body>

  <main>

    <content>

      <h1>Tree styling JSON Data</h1>
      <h2>@jaisocx/tree</h2>
      <h3>tree.prod_mode.html</h3>
      <description>
        Css sites tool styling json data to a tree view
      </description>



      <ThemeButtons>
        <button id="button-turn-on-base-theme" data-theme="">Base Theme</button>
        <button id="button-turn-on-daymode" data-theme="theme_lightmode">Day Mode</button>
        <button id="button-turn-on-nightmode" data-theme="theme_darkmode">Night Mode</button>
      </ThemeButtons>

    </content>


    <h2>json subtree type array</h2>
    <div id="example-tree-holder_SubtreeArrayOfObjects"></div>

    <h2>json subtree type object</h2>
    <div id="example-tree-holder_SubtreeLikeObjects" class="theme-funny"></div>

    <h2>load by url ( works only when published by an http server )</h2>
    <div id="example-tree-holder_load_by_url"></div>


  </main>

</body>



<script>

  let treeExamplesClassInstance = new Object();


  let cssClassesNames = [
    "jsx"
  ];

  let buttonsQuerySelectors = [
    "themebuttons button"
  ];


  let isPreloadWithStopOnLoadTimeout = false;

  let preloaderStopTimeoutMillis = 1200;


  let preloadFontsCDNData = {
    "image": null,
    "font": {
      "theme_font_Baloo_Paaji_2": [
        "https://sandbox.brightday.email/cdn/www/fonts/Baloo_Paaji_2/static/BalooPaaji2-Medium.ttf",
        "https://sandbox.brightday.email/cdn/www/fonts/Baloo_Paaji_2/static/BalooPaaji2-Regular.ttf",
        "https://sandbox.brightday.email/cdn/www/fonts/Baloo_Paaji_2/static/BalooPaaji2-SemiBold.ttf",
      ],
      "theme_font_Niconne": [
        "https://sandbox.brightday.email/cdn/www/fonts/Niconne/Niconne-Regular.ttf",
      ],
    }
  };

  let data_ScriptsChainedLoader = {
    "text": {
      "node_modules": true,
      "npm_namespace": "@jaisocx",
      "scripts": [
        "case_converter/types/DataRecordMatches",
        "case_converter/case_converter_constants/CaseConverterConstants",
        "case_converter/CaseConverter"
      ],
    },
    "preloader": {
      "node_modules": true,
      "npm_namespace": "@jaisocx",
      "scripts": [
        "media_preloader/media_preloader_constants/PreloaderConstants",
        "media_preloader/preloader/Preloader"
      ]
    },
    "theme-turn-on": {
      "node_modules": true,
      "npm_namespace": "@jaisocx",
      "scripts": [
        "constants/ThemeTurnOnConstants",
        "theme_turn_on/ThemeTurnOn"
      ]
    },
    "event-emitter": {
      "node_modules": true,
      "npm_namespace": "@jaisocx",
      "scripts": [
        "EventEmitter",
        "ImprovedRenderEventEmitter"
      ]
    },
    "tokens-parser": {
      "node_modules": true,
      "npm_namespace": "@jaisocx",
      "scripts": [
        "TokensParser"
      ]
    },
    "template-renderer": {
      "node_modules": true,
      "npm_namespace": "@jaisocx",
      "scripts": [
        "TemplateRenderer"
      ]
    },
    "tree": {
      "scripts": [
        "typescript/ArrayOrObjectPackage",
        "typescript/TreeConstants",
        "typescript/TreeConf",
        "typescript/TreeAdapter",
        "typescript/TreeAdapterModeEase",
        "typescript/TreeAdapterModeConf",
        "typescript/Tree"
      ]
    }
  };



  // in this json structure for Tree,
  // the subtree is of type JSON array,
  // where each array item is the object,
  // having data for a Tree node rendering to html,
  // e.g. label text, Tree node html holding element css classes names, and similar.

  // -------------------
  // START TREE CONF DATA
  let treeJson_SubtreeArrayOfObjects = [
    {
      "icon": "MediaAndStyles/themes/theme_base/mini_images/home_tree_mode_conf/house.png",
      "label": "Main",
      "opened": false,
      "text": "<h3>Main tree elem</h3>",
      "subtree": [
        {
          "icon": "MediaAndStyles/themes/theme_base/mini_images/home_tree_mode_conf/google.png",
          "label": "A Link to Google",
          "href": "https://google.com/",
          "cssClassName": "hyperlink"
        },
        {
          "icon": "MediaAndStyles/themes/theme_base/mini_images/home_tree_mode_conf/github.png",
          "label": "A Link to GitHub",
          "href": "https://github.com/orgs/Jaisocx-Tools/repositories",
          "cssClassName": "hyperlink"
        },
        {
          "icon": "MediaAndStyles/themes/theme_base/mini_images/home_tree_mode_conf/catalog.png",
          "label": "echo html",
          "opened": false,
          "subtree": [
            {
              "icon": "MediaAndStyles/themes/theme_base/mini_images/home_tree_mode_conf/html.png",
              "label": "html 1",
              "href": "javascript: void(0);",
              "text": "<h3>Hello World!</h3><p style=\"color:#26d;\">Have fun with styling and using JSTree tool.</p>"
            },
            {
              "icon": "MediaAndStyles/themes/theme_base/mini_images/home_tree_mode_conf/html.png",
              "label": "html 2",
              "href": "javascript: void(0);",
              "text": "<h3>Hello World!</h3><p style=\"color:#d83;\">You can edit code easily, JSTree class is lightweight.</p>"
            },
            {
              "icon": "MediaAndStyles/themes/theme_base/mini_images/home_tree_mode_conf/html.png",
              "label": "html 3",
              "href": "javascript: void(0);",
              "text": "<h3>Hello World!</h3><p style=\"color:#00bb00;\">Have a nice day.</p>"
            }
          ]
        }
      ]
    }
  ];

  // in this json structure the subtree node for sublevel tree nodes is not the array,
  // but the associative array, the object with keys, being not rendered in the Tree,
  // and object values all of type object, containing Tree node data, like label text, link address, and others.
  let treeJson_SubtreeLikeObjects = {
    "fgfgf": {
      "icon": "MediaAndStyles/themes/theme_base/mini_images/home_tree_mode_conf/house.png",
      "label": "Main",
      "opened": true,
      "text": "<h3>Main tree elem</h3>",
      "subtree": {
        "frnynyr": {
          "icon": "MediaAndStyles/themes/theme_base/mini_images/home_tree_mode_conf/google.png",
          "label": "A Link to Google",
          "href": "https://google.com/",
          "cssClassName": "hyperlink"
        },
        "rnyrny": {
          "icon": "MediaAndStyles/themes/theme_base/mini_images/home_tree_mode_conf/github.png",
          "label": "A Link to GitHub",
          "href": "https://github.com/orgs/Jaisocx-Tools/repositories",
          "cssClassName": "hyperlink"
        },
        "rynrnyrn": {
          "icon": "MediaAndStyles/themes/theme_base/mini_images/home_tree_mode_conf/catalog.png",
          "label": "echo html",
          "opened": false,
          "subtree": {
            "rnynry": {
              "icon": "MediaAndStyles/themes/theme_base/mini_images/home_tree_mode_conf/html.png",
              "label": "html 1",
              "href": "javascript: void(0);",
              "text": "<h3>Hello World!</h3><p style=\"color:#26d;\">Have fun with styling and using JSTree tool.</p>"
            },
            "rynynry": {
              "icon": "MediaAndStyles/themes/theme_base/mini_images/home_tree_mode_conf/html.png",
              "label": "html 2",
              "href": "javascript: void(0);",
              "text": "<h3>Hello World!</h3><p style=\"color:#d83;\">You can edit code easily, JSTree class is lightweight.</p>"
            },
            "ghnghn": {
              "icon": "MediaAndStyles/themes/theme_base/mini_images/home_tree_mode_conf/html.png",
              "label": "html 3",
              "href": "javascript: void(0);",
              "text": "<h3>Hello World!</h3><p style=\"color:#00bb00;\">Have a nice day.</p>"
            }
          }
        }
      }
    }
  };
  // -------------------
  // END TREE CONF DATA



  class TreeExamples {

    wasOnceRendered = false;

    themeTurnOn   = new Object();
    scriptsLoader = new Object();
    preloader     = new Object();

    tree_SubtreeArrayOfObjects = new Object();
    tree_load_by_url           = new Object();

    constructor() {
      this.wasOnceRendered = false;

      this.themeTurnOn   = new Object();
      this.scriptsLoader = new Object();
      this.preloader     = new Object();

      this.tree_SubtreeArrayOfObjects = new Object();
      this.tree_load_by_url           = new Object();
    }



    renderTree( holderElemId, data, modeShownNodes ) {

        let baseHtmlElem = document.getElementsByTagName("base")[0];

        this.tree_SubtreeArrayOfObjects = new Tree();

        this.tree_SubtreeArrayOfObjects
          .setDebug( false )
          .setMainHtmlNodeId( holderElemId )
          .setNodesWithIcons( true )
          .setNodesOpenedMode( modeShownNodes )
          .setModifiable( false )
          .setRenderingMode( TreeConstants.RenderingMode.Conf )
          .addThisClassEventListener (
            TreeConstants.TreeEventsNames.EVENT_NAME__BEFORE_RENDER_ONE_NODE,
            ( eventName, eventPayload ) => {

              console.log( eventName, eventPayload );

              let iconSrc = eventPayload.dataForRendering.iconSrc;

              if ( baseHtmlElem.getAttribute("href").startsWith( "https://" ) ) {
                eventPayload.dataForRendering.iconSrc = [ "sites_tools/js_tools/Tree/", iconSrc ].join("");
              }

              return { "value": eventPayload.dataForRendering };
            }
          ).addJSTreeEventListener (
            TreeConstants.TreeEventsNames.EVENT_NAME__TREE_NODE_LABEL__CLICK,
            ( eventName, eventPayload ) => {
              console.log( eventName, eventPayload );

              // on click payload has the ref to the tree.data json, and here we show in console it's value:
              console.log( this.tree_SubtreeArrayOfObjects.getTreeDataNodeByJsonnodePathArray( eventPayload.jsonNode._pathArray ) );
            }
          )
          .render( data );

    }

    loadDataAndRenderTree( holderElemId, dataUrl ) {

        // example to load by url
        this.tree_load_by_url = new Tree();

        this.tree_load_by_url
            .setMainHtmlNodeId("example-tree-holder_load_by_url")
            .setRenderingMode(TreeConstants.RenderingMode.Conf)
            .load( dataUrl );

    }

    renderJsonTreeExamples() {

      this.renderTree (
        "example-tree-holder_SubtreeArrayOfObjects",
        treeJson_SubtreeArrayOfObjects,
        TreeConstants.NodesOpenedMode.ALL_SHOWN
      );

      this.renderTree (
        "example-tree-holder_SubtreeLikeObjects",
        treeJson_SubtreeLikeObjects,
        TreeConstants.NodesOpenedMode.JSON_DATA_DEFINED
      );

      this.loadDataAndRenderTree (
        "example-tree-holder_SubtreeArrayOfObjects",
        "https://sandbox.brightday.email/cdn/www/data_public/json/tree-data/tree-data-to-use-with-conf.json"
      );

    }



    preloadFonts( isWithStopOnLoadTimeout, inTimeoutMillis ) {

      this.preloader = new Preloader();
      this.preloader
        .setThemesPreloads( preloadFontsCDNData )
        .setWebpackAlias( "" )
        .setWebpackAliasReplace( "" )
        .init( isWithStopOnLoadTimeout, inTimeoutMillis );

    }

    addThemeButtonsEventHandlers() {
      this.themeTurnOn = new ThemeTurnOn();
      this.themeTurnOn
        .setKeptCssClassnames( cssClassesNames )
        .addThemeButtonsEventHandlers( buttonsQuerySelectors );

    }


    loadScriptsAndRenderTree() {

      this.scriptsLoader = new ScriptsChainedLoader();
      this.scriptsLoader.onload = this.onDOMContentLoadedEventHandler.bind( this );
      this.scriptsLoader.load ( data_ScriptsChainedLoader, true );

    }

    onChainedDOMContentLoadedEventHandler() {

      try {
        let loaderInstance = typeof ScriptsChainedLoader;

        if ( loaderInstance ) {
          this.loadScriptsAndRenderTree();
          console.log ( "Scripts loader started ..." );
        }
      } catch ( e ) {
        console.error( e );
      }

    }

    onDOMContentLoadedEventHandler() {

        console.log ( "Scripts are loaded, starting TreeExamples.onDOMContentLoadedEventHandler() ..." );

        try {
          this.preloadFonts( isPreloadWithStopOnLoadTimeout, preloaderStopTimeoutMillis );
        } catch (e) {}

        try {
          this.renderJsonTreeExamples();
        } catch (e) {}

        try {
          this.addThemeButtonsEventHandlers();
        } catch (e) {}

        this.wasOnceRendered = true;

        console.log ( "End: ScriptsChainedLoader.load(), TreeExamples.onDOMContentLoadedEventHandler()" );
    }

  }



  document.addEventListener ( 'DOMContentLoaded', () => {

    treeExamplesClassInstance = new TreeExamples();

    //# dev mode: without js preloads and no fallback urls.
    // treeExamplesClassInstance.onDOMContentLoadedEventHandler();

    /* in prod mode,
        You need to set conf json objects like in tree.prod_mode.html:
          Preloader to improve performance when LazyLoad is on ( .ico, images, fonts ) to be available before, when a css classname applies.
          ScriptsChainedLoader to develop and publish for npm or yarn the index.example.html
            with fallback urls feature, due to multiple npm install strategies,
            since with fallback urls, the "onload" event is emitted in the unforeseen timestamp, and after the "DOMContentLoaded" event.

            <!-- <script
              type="text/javascript"
              src="node_modules/@jaisocx/preloader/transpiled/Simple/scripts_chained_loader/ScriptsChainedLoader.js"
              src-fallback="../preloader/transpiled/Simple/scripts_chained_loader/ScriptsChainedLoader.js"
              onload="javascipt: ( () => { if ( treeExamplesClassInstance.wasOnceRendered === true ) { return; }; treeExamplesClassInstance = new TreeExamples(); treeExamplesClassInstance.onDOMContentLoadedEventHandler(); } )();"
              onerror="javascript: ( () => { let tagScript = document.createElement( 'script' ); tagScript.onload = this.onload.bind( tagScript ); tagScript.src = this.getAttribute( 'src-fallback' ); document.body.insertAdjacentElement( 'afterend', tagScript ); this.remove(); } )();">
            </script> ->


        The onChainedDOMContentLoadedEventHandler method invokes ScripsChainedLoader the right way,
          and then ScripsChainedLoader.onload() invokes set of methods,
          planned for DOMContentLoaded like normally when in dev mode or prod mode without fallback urls.
    */
    treeExamplesClassInstance.onChainedDOMContentLoadedEventHandler();

  });

</script>

<script
  type="text/javascript"
  src="node_modules/@jaisocx/preloader/transpiled/Simple/scripts_chained_loader/ScriptsChainedLoader.js"
  src-fallback="../preloader/transpiled/Simple/scripts_chained_loader/ScriptsChainedLoader.js"
  onload="javascipt: ( () => { if ( treeExamplesClassInstance.wasOnceRendered === true ) { return; }; treeExamplesClassInstance = new TreeExamples(); treeExamplesClassInstance.onDOMContentLoadedEventHandler(); } )();"
  onerror="javascript: ( () => { let tagScript = document.createElement( 'script' ); tagScript.onload = this.onload.bind( tagScript ); tagScript.src = this.getAttribute( 'src-fallback' ); document.body.insertAdjacentElement( 'afterend', tagScript ); this.remove(); } )();">
</script>

</html>




